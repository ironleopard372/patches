From c9a45c591c2f24eac16c5b759473a44bd576b59b Mon Sep 17 00:00:00 2001
From: Nathan Chancellor <natechancellor@gmail.com>
Date: Wed, 26 Aug 2020 18:54:18 -0700
Subject: [PATCH 15/15] RISC-V: Workaround -next breakage

Link: https://github.com/ClangBuiltLinux/linux/issues/1143
Link: https://lists.01.org/hyperkitty/list/kbuild-all@lists.01.org/message/NKXLXVU4F5T46SV4DV2DWRWDHI2YYZS3/
Signed-off-by: Nathan Chancellor <natechancellor@gmail.com>
---
 arch/riscv/Kconfig        | 2 +-
 arch/riscv/kernel/setup.c | 1 +
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/arch/riscv/Kconfig b/arch/riscv/Kconfig
index 6ef2394be857..0a71e1996dfb 100644
--- a/arch/riscv/Kconfig
+++ b/arch/riscv/Kconfig
@@ -406,7 +406,7 @@ config EFI_STUB
 
 config EFI
 	bool "UEFI runtime support"
-	depends on OF
+	depends on OF && !CC_IS_CLANG
 	select LIBFDT
 	select UCS2_STRING
 	select EFI_PARAMS_FROM_FDT
diff --git a/arch/riscv/kernel/setup.c b/arch/riscv/kernel/setup.c
index 5ab185130cae..97130ac72e28 100644
--- a/arch/riscv/kernel/setup.c
+++ b/arch/riscv/kernel/setup.c
@@ -19,6 +19,7 @@
 #include <linux/smp.h>
 
 #include <asm/cpu_ops.h>
+#include <asm/io.h>
 #include <asm/setup.h>
 #include <asm/sections.h>
 #include <asm/sbi.h>
-- 
2.28.0

