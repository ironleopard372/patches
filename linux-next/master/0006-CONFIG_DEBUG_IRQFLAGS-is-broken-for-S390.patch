From 547148c51e8623e7956b28a04fa96633ad1b5d96 Mon Sep 17 00:00:00 2001
From: Nathan Chancellor <nathan@kernel.org>
Date: Wed, 3 Feb 2021 11:40:44 -0700
Subject: [PATCH 06/13] CONFIG_DEBUG_IRQFLAGS is broken for S390

Link: https://lore.kernel.org/lkml/871re5dzsy.fsf@nanos.tec.linutronix.de/
Signed-off-by: Nathan Chancellor <nathan@kernel.org>
---
 lib/Kconfig.debug | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/lib/Kconfig.debug b/lib/Kconfig.debug
index 2594818f123e..1a84eece127b 100644
--- a/lib/Kconfig.debug
+++ b/lib/Kconfig.debug
@@ -1336,7 +1336,7 @@ config LOCKDEP_SMALL
 config DEBUG_LOCKDEP
 	bool "Lock dependency engine debugging"
 	depends on DEBUG_KERNEL && LOCKDEP
-	select DEBUG_IRQFLAGS
+	select DEBUG_IRQFLAGS if !S390
 	help
 	  If you say Y here, the lock dependency engine will do
 	  additional runtime checks to debug itself, at the price
@@ -1427,6 +1427,7 @@ config TRACE_IRQFLAGS_NMI
 
 config DEBUG_IRQFLAGS
 	bool "Debug IRQ flag manipulation"
+	depends on !S390
 	help
 	  Enables checks for potentially unsafe enabling or disabling of
 	  interrupts, such as calling raw_local_irq_restore() when interrupts
-- 
2.30.1

