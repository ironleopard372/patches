From 972f6fa3990aeac610b16db7aa8c32b5d4f85b75 Mon Sep 17 00:00:00 2001
From: Nathan Chancellor <natechancellor@gmail.com>
Date: Thu, 27 Aug 2020 14:06:26 -0700
Subject: [PATCH] RISC-V: Workaround -next breakage

Link: https://github.com/ClangBuiltLinux/linux/issues/1143
Link: https://lists.01.org/hyperkitty/list/kbuild-all@lists.01.org/message/NKXLXVU4F5T46SV4DV2DWRWDHI2YYZS3/
Signed-off-by: Nathan Chancellor <natechancellor@gmail.com>
---
 arch/riscv/Kconfig        | 2 +-
 arch/riscv/kernel/setup.c | 1 +
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/arch/riscv/Kconfig b/arch/riscv/Kconfig
index 6ef2394be857..0a71e1996dfb 100644
--- a/arch/riscv/Kconfig
+++ b/arch/riscv/Kconfig
@@ -406,7 +406,7 @@ config EFI_STUB
 
 config EFI
 	bool "UEFI runtime support"
-	depends on OF
+	depends on OF && !CC_IS_CLANG
 	select LIBFDT
 	select UCS2_STRING
 	select EFI_PARAMS_FROM_FDT
diff --git a/arch/riscv/kernel/setup.c b/arch/riscv/kernel/setup.c
index 5ab185130cae..41ef96d0d97a 100644
--- a/arch/riscv/kernel/setup.c
+++ b/arch/riscv/kernel/setup.c
@@ -19,6 +19,7 @@
 #include <linux/smp.h>
 
 #include <asm/cpu_ops.h>
+#include <asm/early_ioremap.h>
 #include <asm/setup.h>
 #include <asm/sections.h>
 #include <asm/sbi.h>

base-commit: f37be72473a007d5d66c52f6cdf43fc8c0961f95
-- 
2.28.0

