From e7413eae3946a0b2d730c8b3fdd20cd3de6f7c7c Mon Sep 17 00:00:00 2001
From: Nathan Chancellor <natechancellor@gmail.com>
Date: Mon, 4 Nov 2019 16:57:32 -0700
Subject: [PATCH 13/17] treewide: Cast arrays used in comparisons to unsigned
 long

Link: https://github.com/ClangBuiltLinux/linux/issues/765
Signed-off-by: Nathan Chancellor <natechancellor@gmail.com>
---
 kernel/extable.c     | 3 ++-
 kernel/trace/trace.c | 2 +-
 lib/dynamic_debug.c  | 2 +-
 mm/kmemleak.c        | 3 ++-
 4 files changed, 6 insertions(+), 4 deletions(-)

diff --git a/kernel/extable.c b/kernel/extable.c
index a0024f27d3a1..dc888c485c13 100644
--- a/kernel/extable.c
+++ b/kernel/extable.c
@@ -34,7 +34,8 @@ u32 __initdata __visible main_extable_sort_needed = 1;
 /* Sort the kernel's built-in exception table */
 void __init sort_main_extable(void)
 {
-	if (main_extable_sort_needed && __stop___ex_table > __start___ex_table) {
+	if (main_extable_sort_needed &&
+	    (unsigned long)__stop___ex_table > (unsigned long)__start___ex_table) {
 		pr_notice("Sorting __ex_table...\n");
 		sort_extable(__start___ex_table, __stop___ex_table);
 	}
diff --git a/kernel/trace/trace.c b/kernel/trace/trace.c
index 607f071013cc..7c8eca506969 100644
--- a/kernel/trace/trace.c
+++ b/kernel/trace/trace.c
@@ -9307,7 +9307,7 @@ __init static int tracer_alloc_buffers(void)
 		goto out_free_buffer_mask;
 
 	/* Only allocate trace_printk buffers if a trace_printk exists */
-	if (__stop___trace_bprintk_fmt != __start___trace_bprintk_fmt)
+	if ((unsigned long)__stop___trace_bprintk_fmt != (unsigned long)__start___trace_bprintk_fmt)
 		/* Must be called before global_trace.buffer is allocated */
 		trace_printk_init_buffers();
 
diff --git a/lib/dynamic_debug.c b/lib/dynamic_debug.c
index c60409138e13..10b65d08abee 100644
--- a/lib/dynamic_debug.c
+++ b/lib/dynamic_debug.c
@@ -1013,7 +1013,7 @@ static int __init dynamic_debug_init(void)
 	int n = 0, entries = 0, modct = 0;
 	int verbose_bytes = 0;
 
-	if (__start___verbose == __stop___verbose) {
+	if ((unsigned long)__start___verbose == (unsigned long)__stop___verbose) {
 		pr_warn("_ddebug table is empty in a CONFIG_DYNAMIC_DEBUG build\n");
 		return 1;
 	}
diff --git a/mm/kmemleak.c b/mm/kmemleak.c
index 3a4259eeb5a0..14c643188cc2 100644
--- a/mm/kmemleak.c
+++ b/mm/kmemleak.c
@@ -1947,7 +1947,8 @@ void __init kmemleak_init(void)
 	create_object((unsigned long)__bss_start, __bss_stop - __bss_start,
 		      KMEMLEAK_GREY, GFP_ATOMIC);
 	/* only register .data..ro_after_init if not within .data */
-	if (__start_ro_after_init < _sdata || __end_ro_after_init > _edata)
+	if ((unsigned long)__start_ro_after_init < (unsigned long)_sdata ||
+	    (unsigned long)__end_ro_after_init > (unsigned long)_edata)
 		create_object((unsigned long)__start_ro_after_init,
 			      __end_ro_after_init - __start_ro_after_init,
 			      KMEMLEAK_GREY, GFP_ATOMIC);
-- 
2.25.0

