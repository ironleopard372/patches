From 77c322e356cdb7930c01edee138315c5e2bb4d37 Mon Sep 17 00:00:00 2001
From: Nathan Chancellor <natechancellor@gmail.com>
Date: Tue, 8 Dec 2020 18:06:05 -0700
Subject: [PATCH 3/8] ubsan: Partially revert
 186c3e18dba3f035b73149f6356f8c1c439288f4

Link: https://github.com/ClangBuiltLinux/linux/issues/1212
Link: https://github.com/ClangBuiltLinux/linux/issues/1213
Signed-off-by: Nathan Chancellor <natechancellor@gmail.com>
---
 lib/Kconfig.ubsan | 1 +
 1 file changed, 1 insertion(+)

diff --git a/lib/Kconfig.ubsan b/lib/Kconfig.ubsan
index 8b635fd75fe4..6872936200f8 100644
--- a/lib/Kconfig.ubsan
+++ b/lib/Kconfig.ubsan
@@ -170,6 +170,7 @@ config UBSAN_ALIGNMENT
 config UBSAN_SANITIZE_ALL
 	bool "Enable instrumentation for the entire kernel"
 	depends on ARCH_HAS_UBSAN_SANITIZE_ALL
+	depends on !COMPILE_TEST
 	default y
 	help
 	  This option activates instrumentation for the entire kernel.
-- 
2.30.0.rc0

