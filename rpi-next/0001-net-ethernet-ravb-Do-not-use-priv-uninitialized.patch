From 74c5dca5fbffabb21c52d4b23635c93815efd169 Mon Sep 17 00:00:00 2001
From: Nathan Chancellor <nathan@kernel.org>
Date: Wed, 14 Apr 2021 09:29:10 -0700
Subject: [PATCH 1/3] net: ethernet: ravb: Do not use priv uninitialized

Fixes: 8ef7adc6beb2 ("net: ethernet: ravb: Enable optional refclk")
Link: https://lore.kernel.org/r/CAHCN7xKp1Lp+KAHwo_GobZoDKQCV9_7Yx2ZNKmTzkkShRBzm_Q@mail.gmail.com/
Signed-off-by: Nathan Chancellor <nathan@kernel.org>
---
 drivers/net/ethernet/renesas/ravb_main.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/renesas/ravb_main.c b/drivers/net/ethernet/renesas/ravb_main.c
index 8c84c40ab9a0..bdf5b6f03490 100644
--- a/drivers/net/ethernet/renesas/ravb_main.c
+++ b/drivers/net/ethernet/renesas/ravb_main.c
@@ -2087,7 +2087,7 @@ static int ravb_probe(struct platform_device *pdev)
 		irq = platform_get_irq(pdev, 0);
 	if (irq < 0) {
 		error = irq;
-		goto out_release;
+		goto out_release_no_priv;
 	}
 	ndev->irq = irq;
 
@@ -2254,6 +2254,7 @@ static int ravb_probe(struct platform_device *pdev)
 		ravb_ptp_stop(ndev);
 out_release:
 	clk_disable_unprepare(priv->refclk);
+out_release_no_priv:
 	free_netdev(ndev);
 
 	pm_runtime_put(&pdev->dev);
-- 
2.31.1.272.g89b43f80a5

