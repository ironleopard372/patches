From d32c6ac8909eb9552d352d570b95a2512d9f125b Mon Sep 17 00:00:00 2001
From: Nathan Chancellor <natechancellor@gmail.com>
Date: Mon, 15 Oct 2018 16:19:57 -0700
Subject: [PATCH 12/13] DO-NOT-UPSTREAM: drm/i915: Disable selftests

Link: https://github.com/ClangBuiltLinux/linux/issues/220
Signed-off-by: Nathan Chancellor <natechancellor@gmail.com>
---
 drivers/gpu/drm/i915/Kconfig.debug | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/drivers/gpu/drm/i915/Kconfig.debug b/drivers/gpu/drm/i915/Kconfig.debug
index 9e36ffb5eb7c..720fb28a0d6c 100644
--- a/drivers/gpu/drm/i915/Kconfig.debug
+++ b/drivers/gpu/drm/i915/Kconfig.debug
@@ -29,7 +29,6 @@ config DRM_I915_DEBUG
 	select DRM_DEBUG_SELFTEST
 	select SW_SYNC # signaling validation framework (igt/syncobj*)
 	select DRM_I915_SW_FENCE_DEBUG_OBJECTS
-	select DRM_I915_SELFTEST
 	select DRM_I915_DEBUG_RUNTIME_PM
         default n
         help
@@ -117,7 +116,7 @@ config DRM_I915_DEBUG_GUC
 
 config DRM_I915_SELFTEST
 	bool "Enable selftests upon driver load"
-	depends on DRM_I915
+	depends on DRM_I915 && !CC_IS_CLANG
 	default n
 	select FAULT_INJECTION
 	select PRIME_NUMBERS
-- 
2.19.1

